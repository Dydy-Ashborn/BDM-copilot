rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Collection des commandes
    match /commandes/{commandeId} {
      // Pour l'instant, accès public en lecture et écriture
      // À modifier avec une authentification pour plus de sécurité
      allow read, write: if true;
      
      // Avec authentification (décommenter si vous ajoutez Firebase Auth) :
      // allow read, write: if request.auth != null;
      
      // Validation des données
      allow create: if request.resource.data.keys().hasAll([
        'nomClient', 
        'telephone', 
        'dateLivraison', 
        'heureLivraison', 
        'contenuCommande', 
        'categories'
      ]) && request.resource.data.telephone.matches('^[0-9]{10}$');
      
      allow update: if request.resource.data.keys().hasAll([
        'nomClient', 
        'telephone', 
        'dateLivraison', 
        'heureLivraison', 
        'contenuCommande', 
        'categories'
      ]) && request.resource.data.telephone.matches('^[0-9]{10}$');
    }
  }
}
